# astronomyengine

The astronomyengine R package provides R bindings to the [Astronomy
Engine](https://github.com/cosinekitty/astronomy). It bundles an
up-to-date copy of the [Astronomy
Engine](https://github.com/cosinekitty/astronomy) C library by Don Cross
as a single-file header + source pair. This provides low-level access to
the C library so that other R packages can link against it via
`LinkingTo` without bundling their own copy.

[Astronomy Engine](https://github.com/cosinekitty/astronomy) is an
open-source library for calculating positions of the Sun, Moon, and
planets, and for predicting astronomical events such as rise/set times,
lunar phases, equinoxes, solstices, eclipses, and transits. It is based
on the [VSOP87](https://en.wikipedia.org/wiki/VSOP_(planets)) planetary
model and is accurate to within approximately ±1 arcminute.

## Using the C library from another package

To use the Astronomy Engine C API from another R package:

1.  Add `astronomyengine` to both `Imports` and `LinkingTo` in your
    `DESCRIPTION`:

    ``` R
    Imports: astronomyengine
    LinkingTo: astronomyengine
    ```

2.  Include the header in your C or C++ source files:

    ``` c
    #include <astronomy/astronomy.h>
    ```

### Key types

| Type                   | Description                                       |
|------------------------|---------------------------------------------------|
| `astro_time_t`         | Date/time in both UT and TT scales                |
| `astro_utc_t`          | Calendar date and time in UTC                     |
| `astro_observer_t`     | Geographic location (latitude, longitude, height) |
| `astro_body_t`         | Enumeration of supported celestial bodies         |
| `astro_vector_t`       | 3-D Cartesian position vector in AU               |
| `astro_state_vector_t` | Position (AU) and velocity (AU/day) vector        |
| `astro_equatorial_t`   | Equatorial coordinates (RA, Dec, distance)        |
| `astro_ecliptic_t`     | Heliocentric ecliptic coordinates                 |
| `astro_horizon_t`      | Topocentric altitude/azimuth coordinates          |
| `astro_rotation_t`     | 3×3 rotation matrix for coordinate transforms     |
| `astro_status_t`       | Success/error code present on every result struct |

### Key functions

| Function                               | Purpose                                              |
|----------------------------------------|------------------------------------------------------|
| `Astronomy_MakeTime()`                 | Construct an `astro_time_t` from calendar components |
| `Astronomy_CurrentTime()`              | `astro_time_t` for the current system time           |
| `Astronomy_AddDays()`                  | Shift an `astro_time_t` by a number of days          |
| `Astronomy_MakeObserver()`             | Construct an `astro_observer_t`                      |
| `Astronomy_GeoVector()`                | Geocentric Cartesian position of a body              |
| `Astronomy_Equator()`                  | Equatorial (RA/Dec) coordinates of a body            |
| `Astronomy_Horizon()`                  | Topocentric altitude/azimuth for an observer         |
| `Astronomy_Seasons()`                  | Equinox and solstice times for a given year          |
| `Astronomy_SearchRiseSetEx()`          | Next rise or set time of a body                      |
| `Astronomy_SearchMoonPhase()`          | Next occurrence of a given lunar phase angle         |
| `Astronomy_SearchMoonQuarter()`        | Next new/quarter/full moon                           |
| `Astronomy_Illumination()`             | Visual magnitude and illuminated fraction            |
| `Astronomy_SearchLunarEclipse()`       | Next lunar eclipse                                   |
| `Astronomy_SearchGlobalSolarEclipse()` | Next global solar eclipse                            |
| `Astronomy_SearchLocalSolarEclipse()`  | Next solar eclipse for an observer                   |
| `Astronomy_SearchTransit()`            | Next transit of Mercury or Venus                     |
| `Astronomy_SearchMaxElongation()`      | Next maximum elongation of an inner planet           |
| `Astronomy_JupiterMoons()`             | State vectors for Io, Europa, Ganymede, Callisto     |
| `Astronomy_Libration()`                | Lunar libration angles                               |
| `Astronomy_Constellation()`            | Constellation containing a given sky position        |
| `Astronomy_GravSimInit()`              | Initialise an n-body gravitational simulator         |

All functions return status-bearing structs. Always check
`status == ASTRO_SUCCESS` before using any other fields of the result.

### Example

``` c
#include <astronomy/astronomy.h>

/* Build a time and a topocentric observer in Sydney */
astro_time_t     t   = Astronomy_MakeTime(2025, 6, 21, 12, 0, 0.0);
astro_observer_t obs = Astronomy_MakeObserver(-33.8688, 151.2093, 0.0);

/* Equatorial coordinates of Mars (of-date, with aberration) */
astro_equatorial_t eq = Astronomy_Equator(
    BODY_MARS, &t, obs, EQUATOR_OF_DATE, ABERRATION
);
if (eq.status == ASTRO_SUCCESS) {
    /* eq.ra   -> right ascension in sidereal hours  */
    /* eq.dec  -> declination in degrees             */
    /* eq.dist -> distance in AU                     */
}

/* Convert to altitude/azimuth for the same observer */
astro_horizon_t hor = Astronomy_Horizon(
    &t, obs, eq.ra, eq.dec, REFRACTION_NORMAL
);
/* hor.altitude -> degrees above (+) or below (-) horizon */
/* hor.azimuth  -> degrees clockwise from north            */

/* Find the next sunrise at the same location */
astro_search_result_t rise = Astronomy_SearchRiseSetEx(
    BODY_SUN, obs, DIRECTION_RISE, t, 1.0, 0.0
);

/* Seasons for 2025 */
astro_seasons_t seasons = Astronomy_Seasons(2025);
/* seasons.mar_equinox, jun_solstice, sep_equinox, dec_solstice */
```

### Supported bodies

The `astro_body_t` enumeration includes: Mercury, Venus, Earth, Mars,
Jupiter, Saturn, Uranus, Neptune, Pluto, Sun, Moon, Earth/Moon
Barycenter (`BODY_EMB`), Solar System Barycenter (`BODY_SSB`), and up to
8 user-defined stars (`BODY_STAR1`–`BODY_STAR8`, defined with
`Astronomy_DefineStar()`).

### Coordinate frame rotations

Astronomy Engine provides rotation matrices between all common reference
frames:

| Frames    | Function                                                        |
|-----------|-----------------------------------------------------------------|
| EQJ ↔︎ EQD | `Astronomy_Rotation_EQJ_EQD()` / `Astronomy_Rotation_EQD_EQJ()` |
| EQJ ↔︎ ECL | `Astronomy_Rotation_EQJ_ECL()` / `Astronomy_Rotation_ECL_EQJ()` |
| EQD ↔︎ HOR | `Astronomy_Rotation_EQD_HOR()` / `Astronomy_Rotation_HOR_EQD()` |
| EQJ ↔︎ GAL | `Astronomy_Rotation_EQJ_GAL()` / `Astronomy_Rotation_GAL_EQJ()` |

Apply a rotation matrix with `Astronomy_RotateVector()`.

## Installation

You can install the released version of astronomyengine from
[CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("astronomyengine")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("mitchelloharawild/astronomyengine")
```

# 

